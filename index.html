<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego del Impostor ğŸ¤«</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .panel {
      display: none;
      padding: 2rem;
    }
    .active {
      display: block;
    }
    .card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
      padding: 2rem;
      margin: 1rem auto;
      max-width: 500px;
      box-shadow: 0 0 15px rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    input, select, button {
      padding: 0.7rem;
      margin: 0.5rem;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
      outline: none;
    }
    input[type="text"], input[type="number"], select {
      background-color: rgba(255, 255, 255, 0.8);
      color: #333;
      width: 100%;
      max-width: 300px;
    }
    button {
      background-color: #00c6ff;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #0072ff;
    }
    .result {
      font-size: 1.5rem;
      margin-top: 1rem;
      font-weight: bold;
    }
    #impostorRolHidden {
      background-color: black;
      color: black;
      border-radius: 0.3rem;
      display: inline-block;
      min-width: 200px;
      min-height: 2.5rem;
      line-height: 2.5rem;
      user-select: none;
      font-weight: bold;
      font-size: 1.5rem;
      transition: background-color 0.3s, color 0.3s;
    }
    #impostorRolHidden.visible {
      background-color: transparent;
      color: white;
    }
    #nombres p,
    .voto-celda {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 0.5rem;
      padding: 0.5rem 1rem;
      margin: 0.5rem auto;
      width: fit-content;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    .voto-celda .nombre {
      flex: 1;
      text-align: left;
    }
    .voto-celda .contador {
      font-weight: bold;
      margin: 0 1rem;
      min-width: 2ch;
    }
    .voto-celda button {
      padding: 0.4rem 1rem;
      font-size: 1rem;
      background-color: #00c6ff;
      color: white;
      border-radius: 0.5rem;
      border: none;
      margin-left: 0.5rem;
      margin-right: 0.2rem;
      transition: background-color 0.3s;
    }
    .voto-celda button:hover {
      background-color: #0072ff;
    }
    #reiniciar {
      background-color: #ff0040;
      padding: 0.7rem 1rem;
      border-radius: 0.8rem;
      font-weight: bold;
      margin-top: 2rem;
      position: static;
    }
    #resultadoFinal {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 1.5rem 0 1rem 0;
      text-shadow: 0 1px 20px #00c6ff, 0 1px 2px #333;
    }
    #masVotado {
      font-size: 1.8rem;
      font-weight: bold;
      margin: 1rem 0 0.5rem 0;
      color: #00fff7;
      text-shadow: 0 1px 10px #0099ff, 0 1px 2px #111;
    }
    .panel .boton-volver {
      margin-top: 1.5rem;
      display: inline-block;
    }
    .panel .boton-otra-partida {
      margin-top: 1.5rem;
      display: inline-block;
      background: #25c481;
      color: #fff;
      border: none;
    }
    .panel .boton-otra-partida:hover {
      background: #206a5d;
    }
  </style>
</head>
<body>

  <button id="reiniciar" onclick="reiniciarJuego()" style="position:fixed;top:15px;left:15px;z-index:999;">ğŸ” Reiniciar</button>

  <div class="panel active" id="inicio">
    <div class="card">
      <h1>ğŸ­ Bienvenidos al Juego del Impostor</h1>
      <p>Â¿Listos para engaÃ±ar o descubrir al impostor? ğŸ”ğŸ˜ˆ</p>
      <button onclick="cambiarPanel('jugadores')">ğŸš€ Empezar</button>
    </div>
  </div>

  <div class="panel" id="jugadores">
    <div class="card">
      <h2>ğŸ‘¥ AÃ±adir Jugadores</h2>
      <input type="text" id="nuevoJugador" placeholder="Nombre del jugador" />
      <button onclick="agregarJugador()">â• AÃ±adir jugador</button>
      <div id="nombres"></div>
      <button onclick="cambiarPanel('tematicas')">âœ… Siguiente</button>
    </div>
  </div>

  <div class="panel" id="tematicas">
    <div class="card">
      <h2>ğŸ“š Elige una temÃ¡tica</h2>
      <select id="selectTematica">
        <option value="" disabled selected>-- Selecciona una temÃ¡tica --</option>
        <option value="Familia">Familia ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ </option>
        <option value="Animales">Animales ğŸ¶ğŸ±</option>
        <option value="Comida">Comida ğŸ•ğŸ”</option>
        <option value="PelÃ­culas">PelÃ­culas ğŸ¬ğŸ¿</option>
        <option value="Deportes">Deportes âš½ğŸ€</option>
        <option value="PaÃ­ses">PaÃ­ses ğŸŒâœˆï¸</option>
        <option value="TecnologÃ­a">TecnologÃ­a ğŸ’»ğŸ“±</option>
        <option value="Frutas">Frutas ğŸğŸŒ</option>
        <option value="Instrumentos musicales">Instrumentos musicales ğŸ¸ğŸ¹</option>
        <option value="Colores">Colores ğŸ¨ğŸŒˆ</option>
        <option value="VehÃ­culos">VehÃ­culos ğŸš—âœˆï¸</option>
        <option value="Profesiones">Profesiones ğŸ‘¨â€âš•ï¸ğŸ‘©â€ğŸ«</option>
        <option value="Videojuegos">Videojuegos ğŸ®ğŸ•¹ï¸</option>
        <option value="Animales marinos">Animales marinos ğŸ ğŸ¬</option>
        <option value="Libros">Libros ğŸ“šğŸ“–</option>
        <option value="Fiestas">Fiestas ğŸ‰ğŸŠ</option>
        <option value="Flores">Flores ğŸŒ¹ğŸŒ»</option>
        <option value="SuperhÃ©roes">SuperhÃ©roes ğŸ¦¸â€â™‚ï¸ğŸ¦¸â€â™€ï¸</option>
        <option value="Planetas">Planetas ğŸªğŸŒŒ</option>
        <option value="Elementos quÃ­micos">Elementos quÃ­micos ğŸ§ªâš—ï¸</option>
        <option value="Animales salvajes">Animales salvajes ğŸ¦ğŸ˜</option>
        <option value="Postres">Postres ğŸ°ğŸ©</option>
        <option value="Instrumentos de cocina">Instrumentos de cocina ğŸ³ğŸ”ª</option>
        <option value="Medios de transporte">Medios de transporte ğŸš‚ğŸ›¥ï¸</option>
        <option value="Marcas famosas">Marcas famosas ğŸ¢ğŸ’¼</option>
        <option value="RÃ­os y lagos">RÃ­os y lagos ğŸŒŠğŸï¸</option>
        <option value="Peces">Peces ğŸŸğŸ </option>
        <option value="Dinosaurios">Dinosaurios ğŸ¦•ğŸ¦–</option>
      </select>
      <br/>
      <button onclick="continuarConfiguracion()">âœ… Siguiente</button>
    </div>
  </div>

  <div class="panel" id="configuracion">
    <div class="card">
      <h2>âš™ï¸ Configurar Juego</h2>
      <p>Â¿CuÃ¡ntos impostores habrÃ¡?</p>
      <input type="number" id="numImpostores" min="1" />
      <button onclick="asignarRoles()">ğŸ”® Asignar roles</button>
    </div>
  </div>

  <div class="panel" id="revelacion">
    <div class="card">
      <h2>ğŸ” Consultar Rol</h2>
      <p>Introduce tu nombre:</p>
      <input type="text" id="nombreConsulta" />
      <button onclick="consultarRol()">ğŸ‘ï¸ Ver mi rol</button>
      <div class="result" id="resultado"></div>
      <button style="margin-top:2rem;" onclick="cambiarPanel('votaciones')">ğŸ—³ï¸ Ir a votaciones</button>
    </div>
  </div>

  <div class="panel" id="votaciones">
    <div class="card">
      <h2>ğŸ—³ï¸ Votaciones</h2>
      <div id="listaVotaciones"></div>
      <button onclick="terminarVotacion()" style="margin-top:2rem;font-size:1.2rem;">Terminar votaciÃ³n</button>
    </div>
  </div>

  <div class="panel" id="resultadoPanel">
    <div class="card">
      <div id="masVotado"></div>
      <div id="resultadoFinal"></div>
      <button class="boton-volver" onclick="volverAVotar()">â¬…ï¸ Volver a votar</button>
      <button class="boton-otra-partida" onclick="jugarOtraPartida()">ğŸ² Jugar otra partida con los mismos jugadores</button>
    </div>
  </div>

<script>
  let jugadores = [];
  let impostores = [];
  let palabra = "";
  let tematicaSeleccionada = "";
  let votos = {}; // {nombre: cantidad}
  let maxVotosPorJugador = 0;

  const tematicasPalabras = {
    "Familia": ["Salma", "Otman", "Aya", "Nadia", "Aziza", "Yasin", "Zakaria", "Awatif", "Saad", "Allal", "Ahmed", "Saadia", "Mohamed", "Abderazak", "Asil", "Basma", "Yasmin", "Ahlam", "Fatima", "Abdelali", "JessicaRazin"],
    "Animales": ["perro", "gato", "elefante", "jirafa", "leÃ³n", "tigre", "oso", "lobo", "zorro", "conejo", "Ã¡guila", "bÃºho", "delfÃ­n", "cocodrilo"],
    "Comida": ["pizza", "hamburguesa", "ensalada", "paella", "sopa", "taco", "pollo", "arroz", "pescado", "pan", "queso", "helado", "chocolate", "pastel"],
    "PelÃ­culas": ["acciÃ³n", "comedia", "drama", "terror", "animaciÃ³n", "romance", "ciencia ficciÃ³n", "aventura", "misterio", "documental"],
    "Deportes": ["fÃºtbol", "baloncesto", "tenis", "nataciÃ³n", "ciclismo", "voleibol", "boxeo", "golf", "rugby", "atletismo"],
    "PaÃ­ses": ["espaÃ±a", "francia", "alemania", "italia", "japÃ³n", "china", "brasil", "argentina", "canadÃ¡", "australia"],
    "TecnologÃ­a": ["ordenador", "telÃ©fono", "robot", "internet", "software", "hardware", "inteligencia artificial", "dron", "impresora", "tableta"],
    "Frutas": ["manzana", "plÃ¡tano", "naranja", "fresa", "pera", "melocotÃ³n", "sandÃ­a", "piÃ±a", "cereza", "mango"],
    "Instrumentos musicales": ["guitarra", "piano", "baterÃ­a", "violÃ­n", "flauta", "saxofÃ³n", "trompeta", "arpa", "clarinete", "acordeÃ³n"],
    "Colores": ["rojo", "azul", "verde", "amarillo", "negro", "blanco", "naranja", "morado", "rosa", "gris"],
    "VehÃ­culos": ["coche", "aviÃ³n", "barco", "tren", "bicicleta", "moto", "camiÃ³n", "autobÃºs", "submarino", "helicÃ³ptero"],
    "Profesiones": ["mÃ©dico", "profesor", "bombero", "ingeniero", "abogado", "policÃ­a", "enfermero", "arquitecto", "chef", "periodista"],
    "Videojuegos": ["aventura", "acciÃ³n", "estrategia", "rol", "disparo", "simulaciÃ³n", "deportes", "arcade", "puzzle", "lucha"],
    "Animales marinos": ["delfÃ­n", "tiburÃ³n", "pulpo", "medusa", "estrella de mar", "ballena", "cangrejo", "langosta", "pez payaso", "foca"],
    "Libros": ["novela", "poesÃ­a", "historia", "ciencia", "fantasÃ­a", "biografÃ­a", "ensayo", "drama", "aventura", "misterio"],
    "Fiestas": ["cumpleaÃ±os", "navidad", "halloween", "carnaval", "aÃ±o nuevo", "pascua", "bodas", "fiesta sorpresa", "aniversario", "graduaciÃ³n"],
    "Flores": ["rosa", "girasol", "tulipÃ¡n", "margarita", "jazmÃ­n", "orquÃ­dea", "lirio", "clavel", "violeta", "azucena"],
    "SuperhÃ©roes": ["spiderman", "batman", "superman", "ironman", "thor", "hulk", "capitÃ¡n amÃ©rica", "wonder woman", "flash", "black widow"],
    "Planetas": ["marte", "venus", "jÃºpiter", "saturno", "urano", "neptuno", "tierra", "mercurio", "plutÃ³n", "luna"],
    "Elementos quÃ­micos": ["hidrÃ³geno", "helio", "oxÃ­geno", "carbono", "nitrÃ³geno", "hierro", "oro", "plata", "cobre", "mercurio"],
    "Animales salvajes": ["leÃ³n", "elefante", "tigre", "rinoceronte", "hipopÃ³tamo", "bÃºfalo", "chimpancÃ©", "gorila", "cocodrilo", "jaguar"],
    "Postres": ["pastel", "flan", "helado", "tarta", "galleta", "brownie", "chocolate", "donut", "crema catalana", "pudin"],
    "Instrumentos de cocina": ["cuchillo", "sartÃ©n", "olla", "batidora", "taza", "cuchara", "tenedor", "tabla de cortar", "colador", "rallador"],
    "Medios de transporte": ["bicicleta", "metro", "autobÃºs", "coche", "tren", "aviÃ³n", "barco", "moto", "taxi", "tranvÃ­a"],
    "Marcas famosas": ["nike", "adidas", "apple", "samsung", "coca-cola", "google", "microsoft", "facebook", "toyota", "bmw"],
    "RÃ­os y lagos": ["amazonas", "nilo", "tÃ¡mesis", "tigre", "Ã©ufrates", "victoria", "baikal", "titicaca", "hurÃ³n", "michigan"],
    "Peces": ["salmÃ³n", "atÃºn", "bacalao", "merluza", "trucha", "pez payaso", "pez globo", "carpa", "pez espada", "lenguado"],
    "Dinosaurios": ["tiranosaurio", "velociraptor", "braquiosaurio", "triceratops", "estegosaurio", "diplodocus", "anquilosaurio", "pterodÃ¡ctilo", "allosaurio", "iguanodon"]
  };

  function cambiarPanel(id) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id === 'votaciones') {
      mostrarVotaciones();
    }
  }

  function agregarJugador() {
    const input = document.getElementById("nuevoJugador");
    const nombre = input.value.trim();
    if (!nombre) {
      alert("Por favor, introduce un nombre vÃ¡lido.");
      return;
    }
    if (jugadores.includes(nombre)) {
      alert("Este jugador ya ha sido aÃ±adido.");
      return;
    }
    jugadores.push(nombre);
    document.getElementById("nombres").innerHTML += `<p>ğŸ‘¤ ${nombre}</p>`;
    input.value = "";
  }

  function continuarConfiguracion() {
    const select = document.getElementById("selectTematica");
    if (!select.value) {
      alert("Por favor, selecciona una temÃ¡tica.");
      return;
    }
    tematicaSeleccionada = select.value;
    cambiarPanel('configuracion');
  }

  async function asignarRoles() {
    const numImp = parseInt(document.getElementById("numImpostores").value);

    if (!numImp || numImp >= jugadores.length || numImp < 1) {
      alert("NÃºmero de impostores no vÃ¡lido. Debe ser al menos 1 y menor que el total de jugadores.");
      return;
    }
    if (jugadores.length < 3) {
      alert("Necesitas al menos 3 jugadores para empezar el juego.");
      return;
    }

    impostores = [...jugadores].sort(() => 0.5 - Math.random()).slice(0, numImp);

    const palabras = tematicasPalabras[tematicaSeleccionada];
    if (!palabras || palabras.length === 0) {
      alert("No hay palabras para esta temÃ¡tica. Por favor selecciona otra.");
      cambiarPanel('tematicas');
      return;
    }

    palabra = palabras[Math.floor(Math.random() * palabras.length)].toLowerCase();
    votos = {};
    maxVotosPorJugador = jugadores.length * 2;
    jugadores.forEach(nombre => votos[nombre] = 0);

    cambiarPanel('revelacion');
    alert("Roles asignados. Cada jugador puede consultar su rol ahora.");
  }

  function toggleImpostorRoleVisibility() {
    const impostorRole = document.getElementById("impostorRolHidden");
    if (impostorRole) {
      impostorRole.classList.toggle("visible");
      const button = document.getElementById("toggleImpostorButton");
      button.textContent = impostorRole.classList.contains("visible") ? "ğŸ™ˆ Ocultar rol" : "ğŸ‘ï¸ Mostrar rol";
    }
  }

  function consultarRol() {
    const inputConsulta = document.getElementById("nombreConsulta");
    const nombre = inputConsulta && inputConsulta.value ? inputConsulta.value.trim() : "";
    const resultado = document.getElementById("resultado");

    if (!jugadores.includes(nombre)) {
      resultado.innerHTML = "âŒ Nombre no encontrado. AsegÃºrate de haberlo escrito correctamente y de que haya sido aÃ±adido.";
      return;
    }

    let textoVisible = impostores.includes(nombre) ? "IMPOSTOR" : palabra;

    resultado.innerHTML = `
      <span id="impostorRolHidden">${textoVisible}</span><br>
      <button id="toggleImpostorButton" onclick="toggleImpostorRoleVisibility()">ğŸ‘ï¸ Mostrar rol</button>
    `;
    inputConsulta.value = '';
  }

  function mostrarVotaciones() {
    const lista = document.getElementById("listaVotaciones");
    lista.innerHTML = "";
    jugadores.forEach((nombre, idx) => {
      lista.innerHTML += `
        <div class="voto-celda" id="voto-celda-${idx}">
          <span class="nombre">ğŸ‘¤ ${nombre}</span>
          <button onclick="sumarVoto('${nombre}')" ${votos[nombre]>=maxVotosPorJugador?"disabled":""}>â•</button>
          <span class="contador" id="contador-${nombre}">${votos[nombre]}</span>
          <button onclick="restarVoto('${nombre}')" ${votos[nombre]<=0?"disabled":""}>â–</button>
        </div>
      `;
    });
  }

  function sumarVoto(nombre) {
    if(votos[nombre] < maxVotosPorJugador) {
      votos[nombre]++;
      document.getElementById("contador-" + nombre).textContent = votos[nombre];
      mostrarVotaciones();
    }
  }

  function restarVoto(nombre) {
    if(votos[nombre] > 0) {
      votos[nombre]--;
      document.getElementById("contador-" + nombre).textContent = votos[nombre];
      mostrarVotaciones();
    }
  }

  function terminarVotacion() {
    let maxVotos = -1;
    let masVotados = [];
    for (const nombre in votos) {
      if (votos[nombre] > maxVotos) {
        maxVotos = votos[nombre];
        masVotados = [nombre];
      } else if (votos[nombre] === maxVotos) {
        masVotados.push(nombre);
      }
    }
    let masVotadoTexto = '';
    if (maxVotos === 0) {
      masVotadoTexto = 'Nadie ha recibido votos.';
      document.getElementById("resultadoFinal").innerHTML = '';
    } else if (masVotados.length === 1) {
      masVotadoTexto = `El mÃ¡s votado es <span style="color:#00fff7">${masVotados[0]}</span> con ${maxVotos} votos.`;
    } else {
      masVotadoTexto = `Empate entre: <span style="color:#00fff7">${masVotados.join(', ')}</span> (${maxVotos} votos cada uno).`;
    }
    document.getElementById("masVotado").innerHTML = masVotadoTexto;

    let resultado = '';
    if (maxVotos > 0) {
      if (masVotados.length === 1) {
        resultado = impostores.includes(masVotados[0])
          ? 'Â¡Era IMPOSTOR! ğŸ‰'
          : 'No era impostor ğŸ˜±';
      } else {
        let hayImpostor = masVotados.some(n => impostores.includes(n));
        resultado = hayImpostor
          ? 'Â¡Al menos uno era IMPOSTOR! ğŸ‰'
          : 'Ninguno era impostor ğŸ˜±';
      }
    }
    document.getElementById("resultadoFinal").innerHTML = resultado;
    cambiarPanel('resultadoPanel');
  }

  function volverAVotar() {
    cambiarPanel('votaciones');
  }

  function jugarOtraPartida() {
    // Solo resetea impostores, palabra, votos, tematicaSeleccionada y recuentos, pero NO jugadores.
    impostores = [];
    palabra = "";
    tematicaSeleccionada = "";
    votos = {};
    maxVotosPorJugador = jugadores.length * 2;
    jugadores.forEach(nombre => votos[nombre] = 0);
    document.getElementById("numImpostores").value = "";
    document.getElementById("selectTematica").selectedIndex = 0;
    document.getElementById("resultado").innerHTML = "";
    document.getElementById("masVotado").innerHTML = "";
    document.getElementById("resultadoFinal").innerHTML = "";
    cambiarPanel('tematicas');
  }

  function reiniciarJuego() {
    jugadores = [];
    impostores = [];
    palabra = "";
    tematicaSeleccionada = "";
    votos = {};
    maxVotosPorJugador = 0;
    document.getElementById("nuevoJugador").value = "";
    document.getElementById("nombreConsulta").value = "";
    document.getElementById("nombres").innerHTML = "";
    document.getElementById("resultado").innerHTML = "";
    document.getElementById("numImpostores").value = "";
    document.getElementById("selectTematica").selectedIndex = 0;
    document.getElementById("listaVotaciones").innerHTML = "";
    document.getElementById("masVotado").innerHTML = "";
    document.getElementById("resultadoFinal").innerHTML = "";
    cambiarPanel('inicio');
  }
</script>

</body>
</html>
